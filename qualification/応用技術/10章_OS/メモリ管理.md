## 実記憶管理
- 限られた主記憶空間を、効率よく使えるようにプログラムに割り当てるのが、実記憶管理の役割
- 連続して10byte並べられるメモリがある場合、2,3,5byteのプログラムがある場合、隙間なしに並べないと全てロードできない。それを管理するというイメージ。
- 実記憶管理の種類
  - 固定区画方式
    - 主記憶に固定長の区画(パーティション)を設ける
    - 全体を単一の区画とする単一区画方式と、複数の区画に分ける多重区画方式がある。
      - 単一だと一つのプログラムしかロードできないのでマルチプログラミングには使えない。
    - 多重区画方式では、マルチプログラミングが可能だが、あまりスペースができてしまった場合使用できないため、メモリ効率は悪い(8MBの区画に4MBのプログラムをロードした場合、残りは使用不可)
  - 可変区画方式
    - プログラムをロードするタイミング絵必要サイズに区切る方式
- フラグメンテーション
  - 可変区画方式でも、プログラムが順番に終わるわけではないので、空きスペースがまばらにできてしまい、プログラムが実行できない現象のこと
- フラグメンテーションが発生した場合に、プログラムを再配置してまとまったメモリ領域を再取得するために、メモリコンパクション・ガーベージコレクションが必要。

### オーバーレイ方式
- 4MBのメモリに対して、6MBのプログラムを実行する場合は、ロードが不可。
- 可能にする方式をオーバーレイ方式という。
  - セグメントという単位に分割して、必要なセグメントだけをメモリ上にロードして実行する。

### スワッピング方式
- 優先度の高いプログラムによる割り込みが発生した場合に、現在実行中のプログラムを一時退避させる。処理中の内容を補助記憶装置に丸ごと退避させることおをスワップアウト、再度メモリにロードする行為をスワップインという。

## 再配置可能プログラムとプログラムの4つの性質
- 再配置可能プログラム
  - 主記憶上のどこに配置しても問題なく実行できる。
  - ベースアドレス指定方式であれば、どこに配置しても問題なし
- 再配置可能(リロケータブル)
  - 主記憶上のどこに配置しても実行することができるという性質
- 再使用可能(リユーザブル)
  - 主記憶上にすでにロードされて処理を終えたプログラムを再ロードすることなく繰り返し実行できる。
- 再入可能(リエントラント)
  - 複数のタスクから呼び出しても互いに干渉することなく実行できるという性質。
- 再帰的(リカーシブ)
  - 実行中に自分自身を実行することができる。
  - スタックという領域に現在の状態を退避させることで処理が実現できている。

## 仮想記憶管理
- 仮想記憶は、主記憶や補助きおくの存在を隠蔽することで、広大なメモリ空間を自由に扱えるようにするもの。
- 仮想記憶を使用することで、別々のメモリ領域を1つのメモリ領域として見立てることができる(イメージ？)
- 仮想アドレスから実アドレスへの変換処理は、メモリ変換ユニット(MMU: Memory Management Unit)というハードウェアが担当する。この仕組みを、動的アドレス変換機能(DAT: Dynamic Address Translator)と呼ぶ。
  - MMUはCPUに内蔵されていたりする
### 実記憶より大きなサイズを提供する仕組み
- 仮想記憶では、補助記憶装置もメモリの一部とすることで、実記憶の容量よりも大きなサイズの記憶空間を使用できる。

### 仮想記憶の実装方式
- ページング方式
  - 仮想アドレス空間を固定長の領域に区切って管理する方式
  - プログラムを「ページ」という単位に分割
- セグメント方式
  - 仮想アドレス空間を可変長の領域に区切って管理する方式
- デマンドページング
  - 実行に必要なページだけを実記憶に読み込ませる方法
- ページテーブル
  - 仮想記憶と実記憶との対応付けをする表
  - 目的のページが実記憶上にないと判明したら補助記憶から実記憶へページが読み込まれる。
### ページングについて
- 仮想記憶には仮想アドレスが含まれている。
- 仮想アドレスには、「ページ番号+ページ内変位」の情報が含まれている。
- ページテーブルを使用してページ番号からメモリ上のページ枠の先頭アドレスを取得できる。
- 実アドレスは、「メモリ上のページ枠の先頭アドレス+ページ内変位」で取得できる。
- ページテーブルを確認して実記憶に存在しないとなった場合は、実記憶へのページ読み込みが発生する。補助記憶から実記憶へのページ読み込みをページインという。
  - ページインしようとしたらメモリがいっぱいでしたという場合は、実記憶から補助記憶へデータを追い出す。これを、ページアウトという。
- 実記憶の容量が少ないと、ページの置き換えを必要とする頻度が高くなり、システムの処理効率が低下する。
- 何をページアウトさせるかのアルゴリズム。それぞれどのページがページアウトの対象となるのかを理解する必要がある。
  - FIFO(First in First out)
    - 最初にページインしたページを追い出す。
  - LIFO(Last in First Out)
    - 最後にページインしたページを追い出す。
  - LRU(Least Recently Used)
    - 最も長い間参照されていないページを追い出す。
  - LFU(Least Frequently Used)
    - 最も参照回数の少ないページを追い出し対象とする。
- デマンドページングとプリページング
  - デマンドページング
    - 実行に必要なページだけをメモリに読み込む
  - プリページング
    - 将来必要になりそうなページをあらかじめメモリに読み込む
- ページングとスワッピング
  - スワッピングは、プロセス単位で領域の出し入れを行う。
  - ページングは、ページ単位で領域の出し入れを行う。
